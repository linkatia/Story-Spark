<!DOCTYPE html>
<html lang= zh-Hant>
  <head>
    <meta charset=UTF-8 />
    <meta name=viewport content=width=device-width initial-scale=1.0 />
    <title>Story Spark</title>
    <script src=https://cdn.tailwindcss.com></script>
  </head>
  <body class=bg-white text-gray-900>
    <div class=flex flex-col items-center justify-center min-h-screen p-6>
      <h1 class=text-3xl font-bold mb-6>Solo Story Shuffle</h1>

      <!-- 按鈕 + 倒數 -->
      <button id=startBtn class=px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 mb-4>
        開始故事
      </button>
      <div id=timer class=text-2xl font-mono mb-6>01:00</div>

      <!-- 三張卡片 -->
      <div class=grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-3xl>
        <div class=border rounded-lg p-4 text-center>
          <h2 class=font-semibold mb-2>角色</h2>
          <p id=role class=text-lg></p>
        </div>
        <div class=border rounded-lg p-4 text-center>
          <h2 class=font-semibold mb-2>場景</h2>
          <p id=place class=text-lg></p>
        </div>
        <div class=border rounded-lg p-4 text-center>
          <h2 class=font-semibold mb-2>事件</h2>
          <p id=event class=text-lg></p>
        </div>
      </div>

      <!-- 提示 -->
      <div id=toast class=mt-6 text-xl font-bold text-red-600></div>
    </div>

    <script>
      // 卡片內容（母池）
      const ROLES = [
        剛上任的市長, 失眠的廚師, 健忘的火車司機,
        追夢的高中生, 退休的魔術師, 害羞的科學家
      ];
      const PLACES = [
        午夜的便利商店, 暴雨中的車站月台, 廢棄的遊樂園,
        考前夜的圖書館, 海邊的停車場, 地下室的練團室
      ];
      const EVENTS = [
        手機只剩 1% 電, 收到一封沒有寄件人的信, 突然全城停電,
        偶遇十年未見的朋友, 必須在 60 秒內做決定, 發現時間倒轉了一分鐘
      ];

      // 同一局的暫存池（每局重置）
      let roundPools = {
        roles: [],
        places: [],
        events: []
      };

      const $ = (id) => document.getElementById(id);
      const startBtn = startBtn;
      const timerEl = timer;
      const roleEl = role;
      const placeEl = place;
      const eventEl = event;
      const toastEl = toast;

      let countdown = null;
      let remaining = 60;

      function formatTime(totalSeconds) {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        const mm = String(minutes).padStart(2, 0);
        const ss = String(seconds).padStart(2, 0);
        return ${mm}:;
      }

      function resetRoundPools() {
        roundPools.roles = [...ROLES];
        roundPools.places = [...PLACES];
        roundPools.events = [...EVENTS];
      }

      function pickAndRemove(pool) {
        if (pool.length === 0) return ;
 const idx = Math.floor(Math.random() * pool.length);
 const [value] = pool.splice(idx, 1);
 return value;
 }

 function drawCards() {
 roleEl.textContent = pickAndRemove(roundPools.roles);
 placeEl.textContent = pickAndRemove(roundPools.places);
 eventEl.textContent = pickAndRemove(roundPools.events);
 }

 function startTimer() {
 clearInterval(countdown);
 remaining = 60;
 timerEl.textContent = formatTime(remaining);
 timerEl.classList.remove(text-red-600);
 toastEl.textContent = ;
        countdown = setInterval(() => {
          remaining--;
          timerEl.textContent = formatTime(remaining);
          if (remaining <= 10) {
            timerEl.classList.add(text-red-600);
          } else {
            timerEl.classList.remove(text-red-600);
          }
          if (remaining <= 0) {
            clearInterval(countdown);
            startBtn.disabled = false;
            toastEl.textContent = 時間到！;
          }
        }, 1000);
      }

      startBtn.addEventListener(click, () => {
        startBtn.disabled = true;   // 整個倒數期間禁用按鈕
        resetRoundPools();          // 新的一局重置暫存池
        drawCards();                // 從暫存池抽，並移除已抽項目
        startTimer();
      });
    </script>
  </body>
</html>
